<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - Classroom</title>
    <link rel="icon" href="https://www.gstatic.com/classroom/logo_square_rounded.svg">
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; overflow: hidden; }

        body {
            font-family: 'Google Sans', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f3f4f6;
            color: #202124;
            display: flex;
            flex-direction: column;
        }

        /* ── HEADER ── */
        .header {
            background-color: #f3f4f6;
            padding: 8px 24px;
            display: flex; align-items: center; justify-content: space-between;
            height: 64px; flex-shrink: 0;
            position: relative; z-index: 200;
        }
        .header-left { display: flex; align-items: center; gap: 16px; }

        .menu-icon {
            width: 18px; height: 13px; cursor: pointer;
            display: flex; flex-direction: column; justify-content: space-between;
        }
        .menu-icon span { width: 100%; height: 2px; background-color: #5f6368; border-radius: 2px; }

        .logo { display: flex; align-items: center; gap: 6px; font-size: 22px; color: #202124; text-decoration: none; }
        .logo-icon { width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; }
        .logo-icon img { width: 32px; height: 32px; }

        .header-right { display: flex; align-items: center; gap: 16px; }
        .icon-button {
            width: 40px; height: 40px; border-radius: 50%; border: none;
            background: transparent; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            color: #5f6368; transition: background-color 0.2s;
        }
        .icon-button:hover { background-color: #e8eaed; }
        .profile-pic {
            width: 32px; height: 32px; border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); cursor: pointer;
        }

        /* ── LAYOUT ── */
        .layout { display: flex; flex: 1; overflow: hidden; }

        /* ── SIDEBAR ── */
        .sidebar {
            width: 72px; min-width: 72px; background-color: #f3f4f6;
            flex-shrink: 0; display: flex; flex-direction: column;
            align-items: center; padding-top: 8px; gap: 4px; z-index: 100;
        }
        .sidebar-item {
            width: 56px; height: 40px; border-radius: 20px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; color: #444746;
            transition: background-color 0.2s; text-decoration: none;
        }
        .sidebar-item:hover { background-color: #e2e4e7; }
        .sidebar-item.active { background-color: #c2e7ff; color: #001d35; }
        .sidebar-item svg { width: 22px; height: 22px; }
        .sidebar-item.gap-above { margin-top: 12px; }
        .sidebar-item.gap-below { margin-bottom: 12px; }

        /* ── MAIN ── */
        .container {
            flex: 1; background-color: #fff;
            border-top-left-radius: 24px;
            padding: 24px; overflow-y: auto;
        }

        /* ── CARDS GRID ── */
        .classes-grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 300px));
            gap: 24px; margin-top: 24px;
        }
        .class-card {
            background: white; border-radius: 8px; overflow: visible;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            cursor: pointer; transition: box-shadow 0.3s, transform 0.2s;
            text-decoration: none; color: inherit; display: block; position: relative;
        }
        .class-card:hover { box-shadow: 0 4px 8px rgba(0,0,0,0.16), 0 2px 4px rgba(0,0,0,0.23); transform: translateY(-2px); }
        .class-card-inner { border-radius: 8px; overflow: hidden; }

        .class-header {
            height: 110px; padding: 14px 16px; color: white;
            position: relative; display: flex; align-items: flex-start;
            overflow: hidden;
        }
        .class-header.theme-blue   { background: linear-gradient(135deg, #1a73e8 0%, #4285f4 100%); }
        .class-header.theme-green  { background: linear-gradient(135deg, #0f9d58 0%, #34a853 100%); }
        .class-header.theme-orange { background: linear-gradient(135deg, #f4511e 0%, #fb8c00 100%); }
        .class-header.theme-red    { background: linear-gradient(135deg, #d93025 0%, #ea4335 100%); }
        .class-header.theme-teal   { background: linear-gradient(135deg, #00897b 0%, #26a69a 100%); }
        .class-header.theme-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .class-header.theme-pink   { background: linear-gradient(135deg, #c2185b 0%, #e91e63 100%); }
        .class-header.theme-indigo { background: linear-gradient(135deg, #3949ab 0%, #5c6bc0 100%); }
        .class-header.theme-image  { background-size: cover; background-position: center; }

        .class-header-text { flex: 1; min-width: 0; }
        .class-name { font-size: 20px; font-weight: 500; margin-bottom: 8px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .class-section { font-size: 13px; opacity: 0.9; }

        .teacher-icon {
            width: 60px; height: 60px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; font-weight: 500;
            position: absolute; right: 16px; top: calc(110px - 30px);
            z-index: 3;
        }
        .class-body { padding: 44px 16px 12px 16px; min-height: 120px; }
        .class-footer {
            padding: 8px 12px; border-top: 1px solid #e0e0e0;
            display: flex; justify-content: flex-end; align-items: center; gap: 4px;
        }
        .footer-btn {
            width: 40px; height: 40px; border-radius: 50%; border: none;
            background: transparent; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            color: #5f6368; transition: background-color 0.2s;
        }
        .footer-btn:hover { background-color: #f1f3f4; }

        /* ── EDIT OVERLAY + DRAWER ── */
        .edit-overlay {
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.32);
            z-index: 300;
            opacity: 0; pointer-events: none;
            transition: opacity 0.25s ease;
        }
        .edit-overlay.open { opacity: 1; pointer-events: all; }

        .edit-drawer {
            position: fixed; top: 0; left: 0; bottom: 0;
            width: 400px;
            background: #fff;
            z-index: 400;
            transform: translateX(-100%);
            transition: transform 0.28s cubic-bezier(.4,0,.2,1);
            display: flex; flex-direction: column;
            box-shadow: 4px 0 28px rgba(0,0,0,0.18);
        }
        .edit-drawer.open { transform: translateX(0); }

        .drawer-header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 20px 20px 16px;
            border-bottom: 1px solid #e8eaed;
            flex-shrink: 0;
        }
        .drawer-title { font-size: 18px; font-weight: 500; color: #202124; }
        .drawer-close {
            width: 36px; height: 36px; border-radius: 50%; border: none;
            background: transparent; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            color: #5f6368; transition: background-color 0.2s;
        }
        .drawer-close:hover { background-color: #f1f3f4; }

        .drawer-body { flex: 1; overflow-y: auto; padding: 12px 20px 20px; }

        .edit-row {
            border: 1px solid #e8eaed;
            border-radius: 12px;
            margin-bottom: 10px;
            overflow: hidden;
        }
        .edit-row-top {
            display: flex; align-items: center; gap: 12px;
            padding: 12px 14px;
            cursor: pointer; user-select: none;
            transition: background-color 0.15s;
        }
        .edit-row-top:hover { background-color: #f8f9fa; }
        .edit-row-swatch { width: 36px; height: 36px; border-radius: 8px; flex-shrink: 0; }
        .edit-row-info { flex: 1; min-width: 0; }
        .edit-row-classname { font-size: 14px; font-weight: 500; color: #202124; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .edit-row-teacher { font-size: 12px; color: #5f6368; margin-top: 2px; }
        .edit-row-chevron {
            width: 20px; height: 20px; color: #80868b; flex-shrink: 0;
            transition: transform 0.2s;
        }
        .edit-row.open .edit-row-chevron { transform: rotate(180deg); }

        .edit-row-body {
            max-height: 0; overflow: hidden;
            transition: max-height 0.28s ease;
            border-top: 0px solid #e8eaed;
        }
        .edit-row.open .edit-row-body { max-height: 520px; border-top-width: 1px; }

        .edit-row-fields { padding: 14px; display: flex; flex-direction: column; gap: 12px; }

        .field-label {
            font-size: 11px; font-weight: 600; color: #80868b;
            text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px;
        }
        .field-input {
            height: 38px;
            border: 1px solid #dadce0; border-radius: 8px;
            padding: 0 12px; font-size: 14px;
            font-family: 'Google Sans', sans-serif; color: #202124;
            outline: none; transition: border-color 0.2s, box-shadow 0.2s;
            display: block;
        }
        .field-input.full { width: 100%; }
        .field-input.short { width: 72px; text-align: center; font-size: 18px; font-weight: 500; }
        .field-input:focus { border-color: #1a73e8; box-shadow: 0 0 0 2px rgba(26,115,232,0.15); }

        .color-swatches { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 4px; }
        .swatch {
            width: 30px; height: 30px; border-radius: 50%; cursor: pointer;
            position: relative; transition: transform 0.15s;
        }
        .swatch:hover { transform: scale(1.15); }
        .swatch.selected::after {
            content: '';
            position: absolute; inset: -4px;
            border-radius: 50%; border: 2.5px solid #202124;
        }
        .swatch-blue   { background: linear-gradient(135deg, #1a73e8, #4285f4); }
        .swatch-green  { background: linear-gradient(135deg, #0f9d58, #34a853); }
        .swatch-orange { background: linear-gradient(135deg, #f4511e, #fb8c00); }
        .swatch-red    { background: linear-gradient(135deg, #d93025, #ea4335); }
        .swatch-teal   { background: linear-gradient(135deg, #00897b, #26a69a); }
        .swatch-purple { background: linear-gradient(135deg, #667eea, #764ba2); }
        .swatch-pink   { background: linear-gradient(135deg, #c2185b, #e91e63); }
        .swatch-indigo { background: linear-gradient(135deg, #3949ab, #5c6bc0); }

        .drawer-footer {
            padding: 12px 20px;
            border-top: 1px solid #e8eaed;
            display: flex; justify-content: flex-end; gap: 10px;
            flex-shrink: 0;
        }
        .btn {
            height: 36px; padding: 0 22px; border-radius: 18px;
            font-size: 14px; font-weight: 500; cursor: pointer;
            font-family: 'Google Sans', sans-serif; transition: background-color 0.2s;
        }
        .btn-cancel { border: 1px solid #dadce0; background: transparent; color: #1a73e8; }
        .btn-cancel:hover { background-color: #e8f0fe; }
        .btn-save { border: none; background: #1a73e8; color: #fff; }
        .btn-save:hover { background: #1557b0; }
    </style>
</head>
<body>

<!-- HEADER -->
<header class="header">
    <div class="header-left">
        <div class="menu-icon" id="menuBtn">
            <span></span><span></span><span></span>
        </div>
        <a href="#" class="logo">
            <div class="logo-icon"><img src="https://www.gstatic.com/classroom/logo_square_rounded.svg" alt="Classroom"></div>
            <span>Classroom</span>
        </a>
    </div>
    <div class="header-right">
        <button class="icon-button">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
        </button>
        <button class="icon-button">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M4 8h4V4H4v4zm6 12h4v-4h-4v4zm-6 0h4v-4H4v4zm0-6h4v-4H4v4zm6 0h4v-4h-4v4zm6-10v4h4V4h-4zm-6 4h4V4h-4v4zm6 6h4v-4h-4v4zm0 6h4v-4h-4v4z"/></svg>
        </button>
        <div class="profile-pic"></div>
    </div>
</header>

<!-- LAYOUT -->
<div class="layout">
    <div class="sidebar">
        <a href="#" class="sidebar-item active">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
        </a>
        <a href="#" class="sidebar-item">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 3h-1V1h-2v2H7V1H5v2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 18H4V8h16v13z"/></svg>
        </a>
        <a href="#" class="sidebar-item gap-above gap-below">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 3L1 9l11 6 9-4.91V17h2V9L12 3zM5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82z"/></svg>
        </a>
        <a href="#" class="sidebar-item">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 2H4c-1 0-2 .9-2 2v18l4-4h14c1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg>
        </a>
        <a href="#" class="sidebar-item">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/></svg>
        </a>
    </div>

    <div class="container">
        <div class="classes-grid" id="classesGrid"></div>
    </div>
</div>

<!-- EDIT OVERLAY (dimmed background) -->
<div class="edit-overlay" id="editOverlay"></div>

<!-- EDIT DRAWER -->
<div class="edit-drawer" id="editDrawer">
    <div class="drawer-header">
        <span class="drawer-title">Edit Classes</span>
        <button class="drawer-close" id="drawerClose">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
    </div>
    <div class="drawer-body" id="drawerBody"></div>
    <div class="drawer-footer">
        <button class="btn btn-cancel" id="btnCancel">Cancel</button>
        <button class="btn btn-save" id="btnSave">Save Changes</button>
    </div>
</div>

<script>
// ── THEME CONFIG ──────────────────────────────────────────────────────────────
const THEMES = {
    blue:   { icon_bg: '#e8f0fe', icon_fg: '#1a73e8', swatch_bg: '#1a73e8' },
    green:  { icon_bg: '#e6f4ea', icon_fg: '#0f9d58', swatch_bg: '#0f9d58' },
    orange: { icon_bg: '#fce8e0', icon_fg: '#f4511e', swatch_bg: '#f4511e' },
    red:    { icon_bg: '#fce8e6', icon_fg: '#d93025', swatch_bg: '#d93025' },
    teal:   { icon_bg: '#e6f4f4', icon_fg: '#00897b', swatch_bg: '#00897b' },
    purple: { icon_bg: '#f3e8fd', icon_fg: '#764ba2', swatch_bg: '#667eea' },
    pink:   { icon_bg: '#fce4ec', icon_fg: '#c2185b', swatch_bg: '#c2185b' },
    indigo: { icon_bg: '#e8eaf6', icon_fg: '#3949ab', swatch_bg: '#3949ab' },
};

// ════════════════════════════════════════════════════════════════
//  ✏️  EDIT YOUR CLASSES HERE
//  name    → the class title shown on the card
//  url     → where clicking the card takes you (use '' to do nothing)
//  teacher → default teacher name (can also be changed in the drawer)
//  letter  → default icon letter  (can also be changed in the drawer)
//  theme   → default color        (can also be changed in the drawer)
//            options: 'blue' | 'green' | 'orange' | 'red' | 'teal' | 'purple' | 'pink' | 'indigo'
// ════════════════════════════════════════════════════════════════
const DEFAULTS = [
    { name: 'Gn-Math',         url: 'https://tmorris01.github.io/gnlinks/esky.html',  teacher: 'TMorris',    letter: 'S', theme: 'blue'   },
    { name: 'Science Adventures', url: '',  teacher: 'Ms. Johnson',  letter: 'J', theme: 'green'  },
    { name: 'History Quest',      url: '',  teacher: 'Dr. Williams', letter: 'W', theme: 'orange' },
    { name: 'English Literature', url: '',  teacher: 'Mrs. Davis',   letter: 'D', theme: 'red'    },
    { name: 'Geography Explorer', url: '',  teacher: 'Mr. Martinez', letter: 'M', theme: 'teal'   },
    { name: 'Art & Design',       url: '',  teacher: 'Ms. Anderson', letter: 'A', theme: 'purple' },
];
// ════════════════════════════════════════════════════════════════

// ── PERSISTENCE ───────────────────────────────────────────────────────────────
function loadClasses() {
    try {
        const saved = JSON.parse(localStorage.getItem('classroomEdits') || 'null');
        if (saved && saved.length === DEFAULTS.length) {
            // name and url always come from DEFAULTS (edit them in the code)
            return DEFAULTS.map((def, i) => ({
                name:    def.name,
                url:     def.url,
                teacher: saved[i].teacher ?? def.teacher,
                letter:  saved[i].letter  ?? def.letter,
                theme:   saved[i].theme   ?? def.theme,
            }));
        }
    } catch(e) {}
    return DEFAULTS.map(d => ({ ...d }));
}

function saveClasses(data) {
    // Only persist the editable fields
    const toSave = data.map(c => ({ teacher: c.teacher, letter: c.letter, theme: c.theme }));
    localStorage.setItem('classroomEdits', JSON.stringify(toSave));
}

let classes = loadClasses();
let draft = [];

// ── HELPERS ───────────────────────────────────────────────────────────────────
function esc(s) {
    return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

// ── RENDER CARDS ──────────────────────────────────────────────────────────────
function renderCards() {
    const grid = document.getElementById('classesGrid');
    grid.innerHTML = '';
    classes.forEach((c) => {
        const t = THEMES[c.theme];
        const card = document.createElement('a');
        card.href = '#';
        card.className = 'class-card';
        card.innerHTML = `
            <div class="class-card-inner">
                <div class="class-header theme-${esc(c.theme)}">
                    <div class="class-header-text">
                        <div class="class-name">${esc(c.name)}</div>
                        <div class="class-section">${esc(c.teacher)}</div>
                    </div>
                </div>
                <div class="class-body"></div>
                <div class="class-footer">
                    <button class="footer-btn" title="Photo" onclick="event.preventDefault()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 15.2A3.2 3.2 0 1 1 15.2 12 3.2 3.2 0 0 1 12 15.2zM9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9z"/></svg>
                    </button>
                    <button class="footer-btn" title="Folder" onclick="event.preventDefault()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"/></svg>
                    </button>
                    <button class="footer-btn" title="More" onclick="event.preventDefault()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg>
                    </button>
                </div>
            </div>
            <div class="teacher-icon" style="background-color:${t.icon_bg}; color:${t.icon_fg};">
                <span>${esc(c.letter)}</span>
            </div>`;
        card.addEventListener('click', e => {
            e.preventDefault();
            if (c.url) window.location.href = c.url;
        });
        grid.appendChild(card);
    });
}

// ── BUILD DRAWER CONTENTS ─────────────────────────────────────────────────────
function buildDrawer() {
    const body = document.getElementById('drawerBody');
    body.innerHTML = '';

    draft.forEach((c, i) => {
        const t = THEMES[c.theme];
        const row = document.createElement('div');
        row.className = 'edit-row';
        row.dataset.index = i;

        const swatchesHtml = Object.entries(THEMES).map(([key]) => `
            <div class="swatch swatch-${key}${c.theme === key ? ' selected' : ''}"
                 data-theme="${key}" data-idx="${i}" title="${key}"></div>
        `).join('');

        row.innerHTML = `
            <div class="edit-row-top">
                <div class="edit-row-swatch" style="background:linear-gradient(135deg,${t.swatch_bg}dd,${t.swatch_bg}99);"></div>
                <div class="edit-row-info">
                    <div class="edit-row-classname">${esc(c.name)}</div>
                    <div class="edit-row-teacher">${esc(c.teacher)}</div>
                </div>
                <svg class="edit-row-chevron" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6z"/>
                </svg>
            </div>
            <div class="edit-row-body">
                <div class="edit-row-fields">
                    <div>
                        <div class="field-label">Teacher Name</div>
                        <input class="field-input full" type="text" data-field="teacher" data-idx="${i}" value="${esc(c.teacher)}" placeholder="Teacher name">
                    </div>
                    <div>
                        <div class="field-label">Icon Letter</div>
                        <input class="field-input short" type="text" data-field="letter" data-idx="${i}" value="${esc(c.letter)}" maxlength="2">
                    </div>
                    <div>
                        <div class="field-label">Header Color</div>
                        <div class="color-swatches">${swatchesHtml}</div>
                    </div>
                </div>
            </div>`;

        // toggle expand/collapse
        row.querySelector('.edit-row-top').addEventListener('click', () => {
            const wasOpen = row.classList.contains('open');
            document.querySelectorAll('.edit-row.open').forEach(r => r.classList.remove('open'));
            if (!wasOpen) row.classList.add('open');
        });

        body.appendChild(row);
    });

    // live update draft on input
    body.querySelectorAll('.field-input').forEach(input => {
        input.addEventListener('input', () => {
            const idx = +input.dataset.idx;
            const field = input.dataset.field;
            let val = input.value;
            if (field === 'letter') val = val.toUpperCase().slice(0, 2);
            draft[idx][field] = val;
            const row = body.querySelector(`.edit-row[data-index="${idx}"]`);
            if (field === 'teacher') row.querySelector('.edit-row-teacher').textContent = val;
        });
    });

    // swatch clicks
    body.querySelectorAll('.swatch').forEach(sw => {
        sw.addEventListener('click', e => {
            e.stopPropagation();
            const idx = +sw.dataset.idx;
            const theme = sw.dataset.theme;
            draft[idx].theme = theme;
            const t = THEMES[theme];
            const row = body.querySelector(`.edit-row[data-index="${idx}"]`);
            row.querySelectorAll('.swatch').forEach(s => s.classList.remove('selected'));
            sw.classList.add('selected');
            row.querySelector('.edit-row-swatch').style.background = `linear-gradient(135deg,${t.swatch_bg}dd,${t.swatch_bg}99)`;
        });
    });
}

// ── DRAWER OPEN / CLOSE / SAVE ────────────────────────────────────────────────
function openDrawer() {
    draft = classes.map(c => ({ ...c }));
    buildDrawer();
    document.getElementById('editOverlay').classList.add('open');
    document.getElementById('editDrawer').classList.add('open');
}

function closeDrawer() {
    document.getElementById('editOverlay').classList.remove('open');
    document.getElementById('editDrawer').classList.remove('open');
}

function saveDrawer() {
    classes = draft.map(c => ({ ...c }));
    saveClasses(classes);   // persist to localStorage
    renderCards();
    closeDrawer();
}

// ── WIRE UP ───────────────────────────────────────────────────────────────────
document.getElementById('menuBtn').addEventListener('click', openDrawer);
document.getElementById('drawerClose').addEventListener('click', closeDrawer);
document.getElementById('editOverlay').addEventListener('click', closeDrawer);
document.getElementById('btnCancel').addEventListener('click', closeDrawer);
document.getElementById('btnSave').addEventListener('click', saveDrawer);

// ── INIT ──────────────────────────────────────────────────────────────────────
renderCards();
</script>
</body>
</html>
